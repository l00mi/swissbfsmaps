<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>SwissMaps</title>
    <meta charset="UTF-8"/>
    <link href="http://netdna.bootstrapcdn.com/bootswatch/2.3.0/cosmo/bootstrap.min.css" rel="stylesheet">
    <style>
    path { fill: none; stroke: #888; stroke-width: .5px; }
    .cantons { fill: #efefef; stroke: none; }
    .canton-boundary { stroke-width: 1px;  } 
    .land-boundary { stroke-width: 2px; }
    .municipality-boundary { stroke: #aaa; }
    </style> 
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>  
    <script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript" src="sgvizler/sgvizler.js"></script>
    <script type="text/javascript" src="http://underscorejs.org/underscore-min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="http://d3js.org/topojson.v0.min.js"></script>
    <script type="text/javascript" src="swissbfsmaps.js"></script>
    <script type="text/javascript">
      sgvizler
          .defaultEndpointURL("http://data.gemeindezukunft.ch/sparql/")
          .defaultEndpointOutputFormat('xml')
	  .prefix('gz', 'http://data.gemeindezukunft.ch/vocab/') 
          .prefix('geo',  'http://www.w3.org/2003/01/geo/wgs84_pos#')
          .prefix('dbp',  'http://dbpedia.org/resource/')
          .prefix('xsd', 'http://www.w3.org/2001/XMLSchema#');
      
      //// Leave this as is. Ready, steady, go!
      $(document).ready(sgvizler.containerDrawAll);
    </script>
  </head>
  <body>
  <div class="container">
    <h1>swissbfsmaps</h1>

    <h2>Choropleth: Inhabitants per Municipality</h2>

    <div id="municipalities1"
	 data-sgvizler-chart-options="domainmin=400|domainmax=300000|colormin=white|colormax=red" 
	 data-sgvizler-query='
SELECT (strafter(str(?remuniuri), "CL_HGDE_GDE/") AS ?remuniid) ?allnumber
WHERE
{
{
SELECT (SUM(?number) AS ?allnumber) ?remuniuri
WHERE
{
?s <http://data.gemeindezukunft.ch/bfs/property/NB_PERSON> ?number;
<http://data.gemeindezukunft.ch/bfs/property/REPORTINGMUNICIPALITYID> ?remuniuri;
<http://data.gemeindezukunft.ch/bfs/property/HISTREPORTINGMUNICIPALITYID> ?muniuri.


#?muniid <http://purl.org/linked-data/xkos#isPartOf> ?district.
#?district <http://purl.org/linked-data/xkos#isPartOf> ?canton.
}
GROUP BY ?remuniuri
}
}

LIMIT 10000
	 '
	 data-sgvizler-endpoint_output="json"
	 data-sgvizler-chart="sgvizler.visualization.swisschoropleth"
	 data-sgvizler-log="2"></div>

    <h2>Choropleth: Average Age per Municipality</h2>

    <div id="municipalities2"
	 data-sgvizler-chart-options="domainmin=30|domainmax=50|colormin=white|colormax=darkred" 
	 data-sgvizler-query='
SELECT (strafter(str(?remuniuri), "CL_HGDE_GDE/") AS ?remuniid) ((?avgnew / ?numberall2) AS ?allavg) 

WHERE
{

SELECT (SUM(?numberall * ?ageamount) AS ?avgnew) (SUM(?numberall) AS ?numberall2) ?remuniuri

WHERE
{

SELECT (SUM(?number) AS ?numberall) ?remuniuri (xsd:int(strafter(str(?age), "CL_AGE_0TO120/")) AS ?ageamount)
WHERE
{
?s1 <http://data.gemeindezukunft.ch/bfs/property/NB_PERSON> ?number;
<http://data.gemeindezukunft.ch/bfs/property/REPORTINGMUNICIPALITYID> ?remuniuri;
<http://data.gemeindezukunft.ch/bfs/property/AGE> ?age.

}
GROUP BY ?remuniuri ?age
}

GROUP BY ?remuniuri

}

LIMIT 10000
	 '
	 data-sgvizler-endpoint_output="json"
	 data-sgvizler-chart="sgvizler.visualization.swisschoropleth"
	 data-sgvizler-log="2"></div>



      <!-- Please leave a link to the Sgvizler homepage  
    <div id="footer">
      <p>
	Sgvizler visualizes the result of SPARQL SELECT queries using
	javascript and the Google Visualization API. For more
	information, see
	the <a href="http://sgvizler.googlecode.com/">Sgvizler</a>
	homepage. (c)
	2011 Martin G. Skj&#230;veland.
      </p>
    </div>-->
    </div>
  </body>
</html>
